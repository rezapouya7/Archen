{% extends 'layout.html' %}
{% load static %}
{% load widget_tweaks %}
<!-- PATH: /Archen/templates/registration/login.html -->

{% block title %}ورود | سامانه آرچن{% endblock %}
{% block page_title %}ورود{% endblock %}
{% block back_button %}{% endblock %}
{% block print_button %}{% endblock %}

{% block content %}
<div class="py-6 font-sans rtl text-right">
  <div class="max-w-md mx-auto px-4">
    <!-- Use the same patterned surface as header to unify visual language -->
    <div class="surface-pattern surface-elevated rounded-xl p-6">
      <form method="post" novalidate class="space-y-4">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="text-red-600 text-sm space-y-1">
            {% for err in form.non_field_errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        {% endif %}

        <div class="flex flex-col">
          <!-- Bolden login form labels for consistency -->
          <label for="id_username" class="text-sm text-gray-700 mb-1 font-bold">نام کاربری</label>
          <select name="username" id="id_username" class="w-full border border-gray-300 p-2 rounded text-sm" dir="rtl" aria-label="انتخاب کاربر">
            <option value="" disabled selected>انتخاب کاربر...</option>
            {% for val,label in login_user_options %}
              <option value="{{ val }}">{{ label }}</option>
            {% endfor %}
          </select>
          {% if form.username.errors %}
            <div class="text-xs text-red-600 mt-1">{% for e in form.username.errors %}<p>{{ e }}</p>{% endfor %}</div>
          {% endif %}
        </div>

        <div class="flex flex-col">
          <label for="id_password" class="text-sm text-gray-700 mb-1 font-bold">رمز عبور</label>
          {{ form.password|add_class:'w-full border border-gray-300 p-2 rounded text-sm' }}
          {% if form.password.errors %}
            <div class="text-xs text-red-600 mt-1">{% for e in form.password.errors %}<p>{{ e }}</p>{% endfor %}</div>
          {% endif %}
        </div>

        <div class="flex items-center gap-2">
          <input type="checkbox" name="remember" id="remember" class="h-4 w-4">
          <label for="remember" class="text-sm text-gray-700 font-bold">مرا به خاطر بسپار</label>
        </div>

        <div class="pt-2">
          <button type="submit" class="w-full px-4 py-2 rounded text-sm font-bold text-center border border-blue-700 text-blue-700 hover:bg-blue-200 transition">
            ورود
          </button>
        </div>
      </form>
    </div>
  </div>
  
</div>
{% endblock %}
<script>
  // Simple client-side filter for username select
  document.addEventListener('DOMContentLoaded', function() {
    var sel = document.getElementById('id_username');
    if (!sel) return;
    // Preserve selection after form re-render
    var currentVal = '{{ form.data.username|default_if_none:"" }}';
    if (currentVal) {
      for (var i=0;i<sel.options.length;i++){ if(sel.options[i].value === currentVal){ sel.selectedIndex = i; break; }}
    }
    // Add a lightweight filter input above the select
    var wrapper = sel.parentElement;
    var input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'جستجو در کاربران...';
    input.className = 'w-full border border-gray-300 p-2 rounded text-sm mb-2';
    wrapper.insertBefore(input, sel);
    input.addEventListener('input', function(){
      var q = this.value.toLowerCase();
      for (var i=0;i<sel.options.length;i++){
        var opt = sel.options[i];
        if (!opt.value) continue; // skip placeholder
        opt.style.display = opt.text.toLowerCase().indexOf(q) !== -1 ? 'block' : 'none';
      }
    });
  });
</script>

